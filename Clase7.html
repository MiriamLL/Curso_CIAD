<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Clase 7</title>
    <meta charset="utf-8" />
    <meta name="author" content="Miriam Lerma" />
    <script src="Clase7_files/header-attrs-2.6/header-attrs.js"></script>
    <link href="Clase7_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <meta name="github-repo" content="MiriamLL/Curso_CIAD"/>
    <meta name="twitter:title" content="Cargar datps"/>
    <meta name="twitter:description" content="Introduccion a RStudioCurso de R"/>
    <meta name="twitter:url" content="https://github.com/MiriamLL/Curso_CIAD/blob/main/Clase3Parte1.html"/>
    <meta name="twitter:image:src" content="https://images.unsplash.com/photo-1525909002-1b05e0c869d8?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=675&amp;q=80"/>
    <meta name="twitter:image:alt" content="Introduccion a R y RStudioCurso de R"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@MiriamLL"/>
    <meta name="twitter:site" content="@MiriamLL"/>
    <meta property="og:title" content="Cargar datps"/>
    <meta property="og:description" content="Introduccion a RStudioCurso de R"/>
    <meta property="og:url" content="https://github.com/MiriamLL/Curso_CIAD/blob/main/Clase3Parte1.html"/>
    <meta property="og:image" content="https://images.unsplash.com/photo-1525909002-1b05e0c869d8?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=675&amp;q=80"/>
    <meta property="og:image:alt" content="Introduccion a R y RStudioCurso de R"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Miriam Lerma"/>
  </head>
  <body>
    <textarea id="source">





class: title-slide, inverse, middle, right
background-image: url(https://images.unsplash.com/photo-1612343267903-f6c1b17e6e1c?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=667&amp;q=80)
background-size: cover

### Clase 7
# Exploración y &lt;br&gt; modelo lineal

**Miriam Lerma**&lt;br&gt;
Marzo 2021

---

# Intro

La clase es de 2 horas.

- Exploracion de datos  
- Modelos lineales




--

## Ustedes

- Conocimientos de R (saben abrirlo, cargar paquetes y datos, saben hacer operaciones y graficos).  

- Quieren conocer explorar datos y conocer la sintaxis para hacer modelos lineales en R.  

--

&lt;br&gt;

 **Notas** &lt;br&gt;
Ya vieron teoria, hoy es solo para que practiquen en R. &lt;br&gt;
Recuerden que los modelos dependen de sus preguntas y experimentos o muestreos.  

---

# Créditos &amp; materiales:  

- Ejercicios de estadística con R &lt;br&gt; 
[Matias Andina](https://bookdown.org/matiasandina/R-intro/modelos-lineales.html)

- Ejemplos de regresiones lineales simples &lt;br&gt;
[Sthda por Alboukadel Kassambara](http://www.sthda.com/english/articles/40-regression-analysis/167-simple-linear-regression-in-r/)⭐ 

- Libro &lt;br&gt; 
[Handbook of Regression Models in People Analytics](http://peopleanalytics-regression-book.org/)  

- Tutoriales diversos &lt;br&gt; 
[STAT 545](https://stat545.com/)

- Ejercicios practicos &lt;br&gt; 
[ourcodingclub](https://ourcodingclub.github.io/tutorials/mixed-models/)

- Outliers &lt;br&gt; 
[Rocio Joo](https://github.com/rociojoo)

- Imágenes adicionales &lt;br&gt; 
[Unsplash](https://unsplash.com/)


---

class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1516478784322-0b77268e6c64?ixid=MXwxMjA3fDB8MHxzZWFyY2h8Mjh8fGRvdHN8ZW58MHx8MHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=60)
background-size: cover


# Exploración

---

# 1.1. Inspecciona

**Siempre inspecciona tus datos!** &lt;br&gt;
Todos esto [graficos]("https://raw.githubusercontent.com/stephlocke/lazyCDN/master/DinoSequential.gif) tienen medias, desviaciones estandar y una correlacion entre puntos similar. 


&lt;img src="https://raw.githubusercontent.com/stephlocke/lazyCDN/master/DinoSequential.gif" height="350" /&gt;

---

## 1.1. Inspecciona

Alberto Cairo creo este paquete (datasauRus) para ilustrarlo.  

.pull-left[
Si quieren replicar algunas graficas:  

```r
#install.packages('datasauRus')
library(datasauRus)
```


```r
ggplot(datasaurus_dozen,
       aes(x=x, y=y, 
           colour=dataset))+
  geom_point()+ 
  theme_void()+ 
  theme(legend.position = "none")+
  facet_wrap(~dataset, ncol=3)
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/unnamed-chunk-6-1.png" width="90%" /&gt;
]

---

# 1.2. Pinguinos
Exploremos los datos de pinguinos.


```r
library(ggplot2)
library(datos)
Pingus&lt;-datos::pinguinos
```

.center[
&lt;img src="https://raw.githubusercontent.com/allisonhorst/palmerpenguins/master/man/figures/lter_penguins.png" height="300" /&gt;
]

---

# 1.2. Pinguinos
Recordemos como se realizan los graficos de puntos. 

.pull-left[

```r
ggplot(Pingus) +
  aes(x = largo_aleta_mm, 
      y = masa_corporal_g)+
* geom_point()
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/first-plot1b-out-1.png" width="80%" /&gt;
]

---

# 1.2. Pinguinos
Sabemos que hay tres especies, separemos las especies por colores.

.pull-left[

```r
ggplot(Pingus, 
       aes(x=largo_aleta_mm, 
           y=masa_corporal_g, 
*          color=especie))+
  geom_point()
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot02-out-1.png" width="80%" /&gt;
]


---

# 1.2. Pinguinos
Si agregamos una nueva capa con la linea de tendencia, especificamos un ajuste lineal ("lm") podemos ver como se relacionan estos datos.  
No obstante! tenemos datos de tres especies diferentes!  

.pull-left[

```r
ggplot(Pingus, 
       aes(x=largo_aleta_mm, 
           y=masa_corporal_g)) +
*      geom_point(aes(color =especie))+
       geom_smooth(method="lm")
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot03-out-1.png" width="80%" /&gt;
]


---

# 1.2. Pinguinos
Cambiando algunos argumentos nos permite explorar y obtener diferentes resultados graficos usando los mismos datos.  
Por ejemplo, si cambiamos la ubicacion del color, le decimos que me haga lineas por especies.

.pull-left[

```r
ggplot(Pingus, 
       aes(x=largo_aleta_mm, 
           y=masa_corporal_g, 
           color = especie)) +
       geom_point() +
*      geom_smooth(method = "lm")
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot04-out-1.png" width="80%" /&gt;
]

---

# 1.3. facet_wrap 

**face_wrap** es un argumento que nos permite ver variables categoricas separadas por panel. 

.pull-left[

```r
ggplot(Pingus, 
       aes(x=largo_pico_mm, 
           y=alto_pico_mm)) +
  geom_point()+
* facet_wrap(~especie)
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot05-out-1.png" width="80%" /&gt;
]

---

class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1516478784322-0b77268e6c64?ixid=MXwxMjA3fDB8MHxzZWFyY2h8Mjh8fGRvdHN8ZW58MHx8MHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=60)
background-size: cover


# Ejercicios

---

# 1. 4. Ejercicios juntos

```r
library(datos)
library(tidyverse)
Pingus&lt;-datos::pinguinos
```

Exploremos los datos usando solo los datos de Pinguinos de Adelia.

```r
Adelia&lt;-Pingus%&gt;%
* filter(especie=='Adelia')
```

&lt;img src="https://raw.githubusercontent.com/allisonhorst/palmerpenguins/master/man/figures/lter_penguins.png" height="200" /&gt;

---

# 1. 4. Ejercicios juntos
Grafico de puntos.  

```r
p1 &lt;- ggplot(Adelia, aes(x=largo_aleta_mm, y=masa_corporal_g)) +
*      geom_point()
p1
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-12-1.png" width="40%" /&gt;

---

# 1. 4. Ejercicios juntos

Boxplot.  

```r
p2 &lt;- ggplot(Adelia, aes(largo_aleta_mm, masa_corporal_g)) +
*      geom_boxplot()
p2
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-13-1.png" width="40%" /&gt;

---

# 1. 4. Ejercicios juntos

Violin.   


```r
p3 &lt;- ggplot(Adelia, aes(largo_aleta_mm, masa_corporal_g)) +
*      geom_violin()
p3
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-14-1.png" width="40%" /&gt;

---

# 1. 4. Ejercicios juntos

Subamos un poco el nivel. 
Combinando boxplot y violin.  
Hagamos un plot compuesto y cambiemos los [colores](https://coolors.co/palettes/trending).  


```r
p4 &lt;- ggplot(Adelia, aes(largo_aleta_mm, masa_corporal_g)) +
*      geom_violin(fill='#e76f51', alpha=0.5)+
*      geom_boxplot(color="#e76f51", fill="#e9c46a",
                    lwd=0.8, width=0.2 )
p4
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-15-1.png" width="40%" /&gt;

---

# 1.4. facet_wrap 

Ver variables categoricas separadas por panel. 


```r
ggplot(Pingus, aes(largo_pico_mm, alto_pico_mm)) +
  geom_point()+
* facet_wrap(~especie)
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-16-1.png" height="10%" /&gt;

---

# 1.4. cowplot

Noten que al usar **facet_wrap** los paneles se acomodan de cierta manera que no es facil de cambiar, para cambiar como estan acomodados podemos usar **cowplot** o **patchwork**.  

Deben instalarlo antes.

```r
#install.packages("cowplot")
library(cowplot)
```

---

# 1.4. cowplot

Elegir el orden.  
Noten que les van a salir muchos warning por que hay NAs en nuestro data frame.

```r
cowplot::plot_grid(p1,p2,p3,p4, #Estos son los plots que crearon antes
                   labels = "AUTO") #&lt;&lt; Agrega letras
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-18-1.png" width="40%" /&gt;


---

class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1599599810769-bcde5a160d32?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1489&amp;q=80)
background-size: cover

# Modelos lineales

---

# 2. Modelos lineales

Recordatorio: 

- La realidad es multidimensional, compleja e incierta.  
- Un modelo es una representación formal de un fenómeno, una reducción de dimensionalidad que posee utilidad práctica.  
- Dicha representación normalmente puede ser condensada en una expresión matemática, una fórmula, que indica cómo una variable se relaciona con otra(s). 
- Empíricamente, el paradigma se basa en estudiar la relación matemática entre variables aleatorias respuesta, con una distribución de probabilidades dada, y aquellas variables que la predicen, con el fin de explicar asociaciones entre variables y realizar inferencia.


---

## 2.1. Generar datos

Cuando busquen ejemplos estadisticos en internet, en algun momento van a toparse con:

```r
set.seed(123)
ejemplo &lt;- rnorm(n = 10000, mean = 0, sd = 1)
```

Que es **set.seed**?  
**set.seed** genera secuencias de numeros "random" pero al poner una "semilla" nos aseguramos de que nos genere la misma secuencia en todas las computadoras.

Que es **rnorm**?  
**rnorm** sirve para generar muestras aleatorias a partir de una población teórica con distribución normal, dandole media y desviación estándar.

--

Cuando hagan preguntas en internet, es muy util usarlo! 

---

## 2.2. Ejemplo practico

### Chocolate y felicidad

-  Supongamos que podemos medir felicidad de manera cuantitativa, como una variable continua.  
- Supongamos, además, que nuestro laboratorio quiere investigar cómo impactan distintas dosis de chocolate a la felicidad de los humanos. 

.center[
&lt;img src="https://images.unsplash.com/photo-1553452118-621e1f860f43?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=634&amp;q=80" height="300" /&gt;
]

---

## 2.2. Chocolate y felicidad
Para esto, tomamos una muestra de **100 voluntarios** y los asignamos de manera aleatoria a **5 dosis de chocolate (20, 40, 60, 80, y 100 gramos)**. Los individuos consumen la dosis asignada, el chocolate aumenta su felicidad (según la fórmula felicidad=dosis∗2.5+10), que medimos y graficamos.

Generar participantes

```r
id &lt;- 1:100
```

Generar dosis

```r
dosis &lt;- sort(rep(seq(20,100,20), 20))
```

Generar respuesta "ideal"

```r
respuesta &lt;- dosis * 2.5 + 10
```

Construir data.frame

```r
datos &lt;- data.frame(id=id,dosis=dosis,respuesta=respuesta)
```

---

## 2.3. Chocolate y felicidad
Asi se veria nuestro modelo **ideal**

.pull-left[

```r
p &lt;- ggplot(datos, 
            aes(x=dosis, 
                y=respuesta))+
      geom_point()+
      xlab("Dosis Chocolate (gr)")+
      ylab("Felicidad")
p
```
]


.pull-right[
&lt;img src="Clase7_files/figure-html/plot10-out-1.png" width="80%" /&gt;
]


---

# 2.4. Chocolate y felicidad

- Pero, en la realidad, esperamos variabilidad en la respuesta al chocolate entre individuos.  
- Si queremos trabajar con un modelo **más realista** deberíamos tener mas variacion en la respuesta:

Semilla para muestras aleatorias.

```r
set.seed(444)
```

Agregar ruido con distribucion normal (media 0, sd = 5)

```r
datos$respuesta &lt;- datos$respuesta + rnorm(n = 100, mean = 0, sd = 5)
```

---

# 2.4. Chocolate y felicidad

- Modelo un poco **más** realista, la respuesta muestra variaciones.

.pull-left[

```r
p &lt;- ggplot(datos, 
            aes(x=dosis, 
                y=respuesta))+
       geom_point(alpha = 0.1)+
       xlab("Dosis Chocolate (gr)")+
       ylab("Felicidad")
p
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot11-out-1.png" width="80%" /&gt;
]


---

# 2.5. Chocolate y felicidad
Entre mayor dosis de chocolate más valor de felicidad.  

- ¿Cuál es el valor esperado de felicidad para una dada dosis de chocolate?  
- ¿Cómo podemos estimarlo?  

.center[
&lt;img src="https://images.unsplash.com/photo-1553452118-621e1f860f43?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=634&amp;q=80" height="300" /&gt;
]

---

# 2.6. Modelo lineal

Para construir modelos en R, es importante el simbolo *virgulilla*

```r
~  
```

En nuestro caso, queremos estudiar la relación entre la felicidad (respuesta) y la dosis de chocolate (dosis).
Entonces el modelo se construiria de la siguiente manera.


```r
modelo_chocolate &lt;- lm(data=datos,
                       respuesta ~ dosis)
```

---

# 2.6. summary
Ver resultados del modelo.

```r
summary(modelo_chocolate)
```

```
## 
## Call:
## lm(formula = respuesta ~ dosis, data = datos)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -9.204 -3.696 -1.330  3.091 11.497 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  8.59279    1.15698   7.427 4.15e-11 ***
## dosis        2.51659    0.01744 144.283  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 4.933 on 98 degrees of freedom
## Multiple R-squared:  0.9953,	Adjusted R-squared:  0.9953 
## F-statistic: 2.082e+04 on 1 and 98 DF,  p-value: &lt; 2.2e-16
```

---

# 2.7. Broom

El paquete broom (de la paqueteria tidyverse), nos permite extraer información estadística de los modelos. 

Aquí está la tabla con los estimadores:

```r
broom::tidy(modelo_chocolate)
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)     8.59    1.16        7.43 4.15e- 11
## 2 dosis           2.52    0.0174    144.   5.93e-116
```

A partir de la columna de estimadores (estimate), vemos que el consumo de chocolate incrementa la felicidad (esperamos mayor un incremento en ~2.52 unidades de felicidad por cada gramo de chocolate).  

Nuestro modelo puede escribirse como:

**felicidad=2.52∗dosis+8.59**

---

# 2.8. Recordatorio

**felicidad=2.52∗dosis+8.59**

&lt;img src="https://datascience.foundation/img/pdf_images/understanding_of_linear_regression_with_python_1.png" height="300" /&gt;

---

# 2.9. Coeficientes.

También podemos acceder a porciones del modelo por separado. 

Coeficientes.  

```r
modelo_chocolate$coefficients
```

```
## (Intercept)       dosis 
##    8.592791    2.516593
```

---

# 2.9. Intervalos.

Intervalos. 

```r
round(confint(modelo_chocolate), 3) 
```

```
##             2.5 % 97.5 %
## (Intercept) 6.297 10.889
## dosis       2.482  2.551
```

Valores predichos.  

```r
head(modelo_chocolate$fitted.values,5)
```

```
##        1        2        3        4        5 
## 58.92464 58.92464 58.92464 58.92464 58.92464
```

Residuales.

```r
head(modelo_chocolate$residuals,5)
```

```
##          1          2          3          4          5 
## -3.7340820 -0.3253313 -7.2040228  1.8230764  6.2374206
```

---

## 2.10. Supuestos

Podemos explorar el ajuste y analizar el cumplimiento de supuestos en R utilizando la función plot que maneja bien objetos lm.

.pull-left[

```r
par(mfrow = c(2, 2))
plot(modelo_chocolate)
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot13-out-1.png" width="100%" /&gt;
]

---

## 2.11. Nuevo modelo

Cambiemos nuestros datos para un peor ajuste. 

```r
datos$nueva_dosis &lt;- datos$dosis + rnorm(100,10,10)
```

Creemos un nuevo modelo.

```r
nuevo_modelo &lt;- lm(data = datos,
                   respuesta~nueva_dosis)
```

Agreguemos los valores predichos y los residuales a nuestro data frame.

```r
datos$nuevo_pred &lt;- nuevo_modelo$fitted.values
datos$residuos &lt;- nuevo_modelo$residuals 
```

---

# 2.11. Nuevo modelo

Estos son nuestros nuevos datos, y la linea de regression. 


```r
Plot_nueva_dosis&lt;- ggplot(datos, aes(nueva_dosis, respuesta))+
  geom_point()+
  geom_point(aes(nueva_dosis, nuevo_pred), color="gray50", pch=1) +
  theme(plot.background = element_rect(colour = NA))+
  xlab("Dosis Chocolate (gr)")+
  ylab("Felicidad")
Plot_nueva_dosis
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-40-1.png" width="40%" /&gt;

---

## 2.11. Residuales

Agregar los residuales.

```r
Plot_nueva_dosis +
* geom_segment(aes(xend = nueva_dosis,
*                  yend = nuevo_pred),
               alpha=0.5)
```

&lt;img src="Clase7_files/figure-html/unnamed-chunk-41-1.png" width="40%" /&gt;

---

## 2.11. Residuales

Lo que nuestra regresión está realizando es minimizar la suma de los residuos al cuadrado.  
Una herramienta para visualizar mejor los puntos con residuos grandes es graficarlos utilizando una escala de color y tamaño.

.pull-left[

```r
ggplot(datos, aes(nueva_dosis, respuesta))+
  geom_point(aes(color = residuos, size=abs(residuos)))+ 
  geom_point(aes(nueva_dosis, nuevo_pred), color="gray50", pch=1) +
  geom_segment(aes(xend = nueva_dosis, yend = nuevo_pred),
               alpha=0.5)+
  xlab("Dosis Chocolate (gr)")+
  ylab("Felicidad")+
  scale_color_gradientn(colours = c("red", "black", "red"))+
  guides(color = FALSE,
         size = FALSE)
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot14-out-1.png" width="80%" /&gt;
]

---

## 2.12. ¿Por qué hacer una regresión?

Los objetivos de realizar un análisis de regresión pueden resumirse en:

- Describir la relación funcional entre X e Y
- Determinar cuánta de la variación en Y puede ser explicada por la variación de X y cuánto permanece sin explicar.
- Estimar los parámetros del modelo.
- Hacer inferencia sobre los parámetros del modelo (mediante pruebas de hipótesis y cálculo de intervalos de confianza).

---

## 2.13 Ejercicios juntos

Modelo ideal.

```r
id &lt;- 1:100 
dosis &lt;- sort(rep(seq(20,100,20), 20))
respuesta &lt;- dosis * 2.5 + 10
datos &lt;- data.frame(id=id,
                    dosis=dosis,
                    respuesta=respuesta)
```

Explorar los datos.

```r
p &lt;- ggplot(datos, 
            aes(x=dosis, y=respuesta))+
      geom_point()+
      xlab("Dosis Chocolate (gr)")+
      ylab("Felicidad")
p
```

---

## 2.14. Ejercicios juntos

Modelo con un poco mas realista.

```r
set.seed(444)
datos$respuesta &lt;- datos$respuesta + rnorm(n = 100, mean = 0, sd = 5)
```

Explorar los datos.

```r
p &lt;- ggplot(datos, 
            aes(x=dosis, y=respuesta))+
       geom_point(alpha = 0.1)+
       xlab("Dosis Chocolate (gr)")+
       ylab("Felicidad")
p
```

---

## 2.14. Ejercicios juntos

Sintaxis de modelos lineares.

```r
modelo_chocolate &lt;- lm(data=datos,
                       respuesta ~ dosis)
```

Obtener estimadores.

```r
summary(modelo_chocolate)
broom::tidy(modelo_chocolate)
```

Ver coeficientes.

```r
modelo_chocolate$coefficients
```

Graficar

```r
ggplot(datos, aes(dosis, respuesta))+ geom_point(alpha = 0.1)+
       xlab("Dosis Chocolate (gr)")+ylab("Felicidad")+
  geom_smooth(method = "lm", color="lightgray", se=FALSE)+
  stat_summary(fun = mean, geom="point", size=2, color="red")
```

---

## 2.14. Ejercicios juntos

Cambiemos nuestros datos para un peor ajuste. 

```r
datos$nueva_dosis &lt;- datos$dosis + rnorm(100,10,10)
```


```r
nuevo_modelo &lt;- lm(data = datos,
                   respuesta~nueva_dosis)
```


```r
datos$nuevo_pred &lt;- nuevo_modelo$fitted.values
datos$residuos &lt;- nuevo_modelo$residuals 
```


```r
ggplot(datos, aes(nueva_dosis, respuesta))+
  geom_point(aes(color = residuos, size=abs(residuos)))+ 
  geom_point(aes(nueva_dosis, nuevo_pred), color="gray50", pch=1) +
  geom_segment(aes(xend = nueva_dosis, yend = nuevo_pred),
               alpha=0.5)+
  xlab("Dosis Chocolate (gr)")+
  ylab("Felicidad")+
  scale_color_gradientn(colours = c("red", "black", "red"))+
  guides(color = FALSE,
         size = FALSE)
```

---

class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1476837579993-f1d3948f17c2?ixlib=rb-1.2.1&amp;ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;auto=format&amp;fit=crop&amp;w=1350&amp;q=80)
background-size: cover

# Outliers

---

## 3. Outliers

Un valor atípico (en inglés outlier) es una observación que es numéricamente distante del resto de los datos.
- Que hacer con ellos?

---

## 3. Outliers

Generemos datos.

```r
set.seed(42)
ex_data  = data.frame(x = 1:10,
                      y = 10:1 + rnorm(n = 10))
ex_model = lm(y ~ x, data = ex_data)
```

.pull-left[

```r
ggplot(data = ex_data, 
       aes(x = x, 
           y = y)) +
  geom_smooth(data = ex_data, method = "lm", se = FALSE, aes(color = "inicial")) + 
  geom_smooth(method = "lm", se = FALSE, aes(color = "nuevo"), linetype = 2) + 
  scale_color_manual(name = "modelos", labels = c("inicial", "nuevo"), values = c("#56B4E9", "#E69F00")) +
theme_bw()
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot21-out-1.png" width="80%" /&gt;
]

---

## 3. Outliers

Añadamos un punto (x, y) y reajustemos una regresión lineal

```r
point_1 = c(5.4, 11) # nuevo punto
ex_data_1 = rbind(point_1, ex_data) 
model_1 = lm(y ~ x, data = ex_data_1) 
```


.pull-left[

```r
ggplot(data = ex_data_1, aes(x = x, 
                             y = y)) +
  geom_point(color = "black") + # plotting all points
  geom_point(aes(x = x[1], y = y[1]), cex = 4, shape = 1) + # Denotar el nuevo punto
  geom_smooth(data = ex_data, method = "lm", # línea de regresión del modelo inicial
              se = FALSE, aes(color = "inicial")) + 
  geom_smooth(method = "lm", # línea de regresión del nuevo modelos
              se = FALSE, aes(color = "nuevo"), linetype = 2) + 
  scale_color_manual(name = "modelos", 
                     labels = c("inicial", "nuevo"), 
                     values = c("red", "blue")) +
theme_bw()
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot22-out-1.png" width="80%" /&gt;
]


---

## 3.2. Otro outlier

Creemos un nuevo punto, agreguemoslo al data frame y creemos un nuevo modelo.

```r
point_2 = c(18, -5.7) 
ex_data_2 = rbind(point_2, ex_data) 
model_2 = lm(y ~ x, data = ex_data_2) 
```

.pull-left[

```r
ggplot(data = ex_data_2, aes(x = x, y = y)) +
  geom_point(color = "black") + # plotting all points
  geom_point(aes(x = x[1], y = y[1]), cex = 4, shape = 1) + # circunferencia para el nuevo punto
  geom_smooth(data = ex_data, method = "lm", se = FALSE, aes(color = "inicial")) + # línea de regresión del modelo inicial
  geom_smooth(method = "lm", se = FALSE, aes(color = "nuevo"), linetype = 2) + # línea de regresión del nuevo modelo
  scale_color_manual(name = "modelos", labels = c("inicial", "nuevo"), values = c("red", "blue")) +
theme_bw()
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot23-out-1.png" width="80%" /&gt;
]


---

## 3.3. Un ultimo outlier

Creemos un nuevo punto, agreguemoslo al data frame y creemos un nuevo modelo.

```r
point_3 = c(14, 5.1) 
ex_data_3 = rbind(point_3, ex_data) 
model_3 = lm(y ~ x, data = ex_data_3) 
```

El nuevo modelo parece bastante distinto.
.pull-left[

```r
ggplot(data = ex_data_3, aes(x = x, y = y)) +
  geom_point(color = "black") + 
  geom_point(aes(x = x[1], y = y[1]), cex = 4, shape = 1) + #
  geom_smooth(data = ex_data, method = "lm", se = FALSE, aes(color = "inicial")) + 
  geom_smooth(method = "lm", se = FALSE, aes(color = "nuevo"), linetype = 2) + 
  scale_color_manual(name = "modelos", labels = c("inicial", "nuevo"), values = c("red", "blue")) +
theme_bw()
```
]

.pull-right[
&lt;img src="Clase7_files/figure-html/plot24-out-1.png" width="80%" /&gt;
]

---


class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1612343267903-f6c1b17e6e1c?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=667&amp;q=80)
background-size: cover


# Recapitulando

1.1. Explorar datos.  
1.2. Modelo lineal.

Siguiente clase:  
2.1. Objetos clase factor.  
2.2. Analisis de varianza.  


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
