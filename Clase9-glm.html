<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Clase modelos</title>
    <meta charset="utf-8" />
    <meta name="author" content="Miriam Lerma" />
    <script src="Clase9-glm_files/header-attrs-2.6/header-attrs.js"></script>
    <meta name="github-repo" content="MiriamLL/Curso_CIAD"/>
    <meta name="twitter:title" content="Cargar datps"/>
    <meta name="twitter:description" content="Introduccion a RStudioCurso de R"/>
    <meta name="twitter:url" content="https://github.com/MiriamLL/Curso_CIAD/blob/main/Clase3Parte1.html"/>
    <meta name="twitter:image:alt" content="Introduccion a R y RStudioCurso de R"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@MiriamLL"/>
    <meta name="twitter:site" content="@MiriamLL"/>
    <meta property="og:title" content="Cargar datps"/>
    <meta property="og:description" content="Introduccion a RStudioCurso de R"/>
    <meta property="og:url" content="https://github.com/MiriamLL/Curso_CIAD/blob/main/Clase3Parte1.html"/>
    <meta property="og:image:alt" content="Introduccion a R y RStudioCurso de R"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Miriam Lerma"/>
    <link href="Clase9-glm_files/panelset-0.2.4/panelset.css" rel="stylesheet" />
    <script src="Clase9-glm_files/panelset-0.2.4/panelset.js"></script>
    <link rel="stylesheet" href="RZero-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">










class: title-slide, inverse, middle, right
background-image: url(https://images.unsplash.com/photo-1602264419088-8f8c7ab48489?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1267&amp;q=80)
background-size: cover

### Clase modelos
# Modelos mixtos

## Miriam Lerma&lt;br&gt;
Mayo 2021

---

class: inverse

# Intro
- [Modelos mixtos](#lmer)
- [Incluir efectos aleatorios](#random_effects)
- [Incluir efectos anidados](#nested_effects)
- [AIC](#AIC)
- [Comparar modelos](#comparar)

--

#### Ustedes

- Conocimientos de R (saben abrirlo, cargar paquetes y datos, saben hacer operaciones y gráficos).  
- Quieren crear modelos mixtos en R y conocer la sintaxis. 
La clase de hoy esta en el [repositorio](https://github.com/MiriamLL/Prueba)
Clonen/Descarguen los materiales.  

#### Preguntas
Responder en el chat 💬
- Han visto modelos mixtos en artículos o tesis?
- Alguien ha escuchado que es el AIC?

---
class: inverse

## Créditos &amp; Recursos

Lecturas
- [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#f2cc8f;" viewBox="0 0 576 512"&gt;&lt;path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"/&gt;&lt;/svg&gt; Intro por Gabriela Hajduk](https://gkhajduk.github.io/2017-03-09-mixed-models/)
- [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#f2cc8f;" viewBox="0 0 576 512"&gt;&lt;path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"/&gt;&lt;/svg&gt; Introduccion](https://athanasiamo.github.io/LME_introduction_workshop/slides/lme_rladies_london.html#1)&lt;br&gt;

Videos en español
- [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#f2cc8f;" viewBox="0 0 576 512"&gt;&lt;path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/&gt;&lt;/svg&gt; Modelos mixtos por Sara Acevedo](https://vimeo.com/526381086)&lt;br

En ingles  
- [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#f2cc8f;" viewBox="0 0 576 512"&gt;&lt;path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/&gt;&lt;/svg&gt; Teoría](https://www.youtube.com/watch?v=sdYKtsmtXmc&amp;list=PLVlVXU7jGfm1seY4xxINrsp23AmrYFYa7&amp;index=4)

- [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#f2cc8f;" viewBox="0 0 576 512"&gt;&lt;path d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"/&gt;&lt;/svg&gt; Michel Clark](https://m-clark.github.io/mixed-models-with-R/#)

Imagenes
- Portada
[Unsplash by Ilse Orsel](https://unsplash.com/@lgtts)  


---

name: repro
class: center, middle, inverse

# 1. Modelos lineares mixtos

---

## 1.1. Intro

Modelos lineales:  
- Errores aleatorios independientes
- Errores aleatorios siguen una distribución normal

Modelos lineales mixtos
- Incorpora efectos aleatorios para acomodar la correlación entre las observaciones 
- Condicionado a los efectos aleatorios, los errores aleatorios son independientes con  varianza constante 
- Errores aleatorios con distribución normal
- Efectos aleatorios con distribución normal 
- Efectos aleatorios y errores aleatorios son independientes 


---

## 1.2. Porque usarlos?

- Datos pueden presentar heterogeneidad
- Por ejemplo: pueden estar agrupados por provenir de diferentes áreas, o presentar medidas repetidas
- Medidas repetidas induce a una estructura de correlación, que si no se considera puede llevar a estimaciones sesgadas
- Afectando las predicciones y por lo tanto las decisiones basadas en esos datos


---
name: lmer

# 2. Modelo
## 2.2. Datos

Paquetes a cargar para leer los datos

```r
library(tidyverse)
library(readr)
library(dplyr)
library(here)
```

Cargar datos

```r
url &lt;- "https://raw.githubusercontent.com/alejandraandrea/slides-xaringan-mixed-models/master/dragons.tsv"
download.file(url, "dragons.tsv")
dragones &lt;- read_tsv("dragons.tsv") #read_tsv de {readr}
```


```r
here('dragones.csv')
```

```
## [1] "C:/Users/Lerma/Documents/4Cursos/1CIAD/11Presentaciones/Curso_CIAD/dragones.csv"
```

---

## 2.2. Datos

Los datos contienen 480 observaciones.
4 columnas: testScore, bodyLenght, montainRange, site

```r
glimpse(dragones)
```

```
## Rows: 480
## Columns: 4
## $ testScore     &lt;dbl&gt; 16.147309, 33.886183, 6.038333, 18.838821, 33.862328, 47~
## $ bodyLength    &lt;dbl&gt; 165.5485, 167.5593, 165.8830, 167.6855, 169.9597, 168.68~
## $ mountainRange &lt;chr&gt; "Bavarian", "Bavarian", "Bavarian", "Bavarian", "Bavaria~
## $ site          &lt;chr&gt; "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "~
```

Cambiar nombres a espaniol

```r
dragones&lt;-dragones%&gt;%
    rename(calificacion=testScore,
           tamanio = bodyLength,
           montania = mountainRange,
           sitio=site)
```

---

## 2.3. Preguntas

Se entrenaron a los dragones y se recopilaron datos de cada montania.

Entre mas rapido aprendieron el entrenamiento mejor calificacion, tambien se midieron y se anoto en que sitio y en que region provenian.

Afectara el tamanio de los dragones a sus calificaciones?


---

## 2.4. Inspeccionar datos


```r
dragones %&gt;% ggplot(aes(x=tamanio, 
             y=calificacion)) + 
             geom_jitter(alpha=.2)+
             theme_bw()
```


---

## 2.5 Ajustar modelo lineal

```r
library(broom)
```

Primero ajustar un modelo lineal

```r
ajuste_lm &lt;- lm(calificacion ~ tamanio, data=dragones)
```

Estadisticos del modelo

```r
broom::tidy(ajuste_lm) %&gt;% tibble::as_tibble()
```

```
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  -61.3     12.1        -5.08 5.38e- 7
## 2 tamanio        0.555    0.0597      9.29 5.59e-19
```

Información sobre el modelo

```r
glance(ajuste_lm) %&gt;% tibble::as_tibble()
```

```
## # A tibble: 1 x 12
##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.153         0.151  21.2      86.2 5.59e-19     1 -2146. 4298. 4311.
## # ... with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;
```

---

## 2.6. Ajustar modelo lineal


```r
info_ajuste_lm&lt;-augment_columns(ajuste_lm, dragones)
```



```r
info_ajuste_lm %&gt;% 
ggplot(aes(x=tamanio,y=calificacion))+ 
geom_jitter(alpha=.2)+
geom_line(aes(x=tamanio,y=.fitted))+
theme_bw()
```

![](Clase9-glm_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;

---

## 2.7. Supuestos

Linealidad

```r
plot(ajuste_lm, which=1)
```

![](Clase9-glm_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

Normalidad

```r
plot(ajuste_lm, which=2)
```

![](Clase9-glm_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

Homocedasticidad

```r
plot(ajuste_lm, which=3)
```

![](Clase9-glm_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

## 2.8. Inspeccionar


```r
dragones %&gt;%
  ggplot(aes(x=tamanio,y=calificacion, 
        colour=montania)) +
  geom_jitter(alpha=2) +
  theme_bw()
```

![](Clase9-glm_files/figure-html/unnamed-chunk-18-1.png)&lt;!-- --&gt;

---

## 2.8. Inspeccionar


```r
dragones %&gt;% 
  ggplot(aes(tamanio,calificacion,
      colour = montania))+
  geom_jitter(alpha=2) + 
  facet_wrap(~ montania) +
  theme_bw()+
  theme(strip.background=element_rect(fill="white"))
```

![](Clase9-glm_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;

No se puede omitir la montania, pero como la incluimos?

---
name: random_effect

## 2.9. Efectos aleatorios

Paquetes

```r
#install.packages('broom.mixed')
#install.packages('lme4')
library(broom.mixed)
```

```
## Warning: package 'broom.mixed' was built under R version 4.0.5
```

```
## Warning in checkMatrixPackageVersion(): Package version inconsistency detected.
## TMB was built with Matrix version 1.3.2
## Current Matrix version is 1.2.18
## Please re-install 'TMB' from source using install.packages('TMB', type = 'source') or ask CRAN for a binary version of 'TMB' matching CRAN's 'Matrix' package
```

```
## Registered S3 method overwritten by 'broom.mixed':
##   method      from 
##   tidy.gamlss broom
```

```r
library(lme4)
```

```
## Loading required package: Matrix
```

```
## 
## Attaching package: 'Matrix'
```

```
## The following objects are masked from 'package:tidyr':
## 
##     expand, pack, unpack
```

Sintaxis de los efectos aleatorios (random effects)

```r
ajuste_lmer &lt;- lmer(calificacion ~ tamanio + (1|montania), data = dragones)
```


```r
tidy(ajuste_lmer) %&gt;% tibble::as_tibble()
```

```
## # A tibble: 4 x 6
##   effect   group    term            estimate std.error statistic
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 fixed    &lt;NA&gt;     (Intercept)      43.7      17.1        2.55 
## 2 fixed    &lt;NA&gt;     tamanio           0.0332    0.0786     0.422
## 3 ran_pars montania sd__(Intercept)  18.4      NA         NA    
## 4 ran_pars Residual sd__Observation  15.0      NA         NA
```


```r
glance(ajuste_lmer) %&gt;% tibble::as_tibble()
```

```
## # A tibble: 1 x 6
##   sigma logLik   AIC   BIC REMLcrit df.residual
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
## 1  15.0 -1996. 3999. 4016.    3991.         476
```

No hay valor p

---

## 2.9. Valor p

La libreria lmerTest te puede dar un valor p, pero regularmente hay que llevar los modelos mas alla. 


```r
library(lmerTest)
```

```
## Warning: package 'lmerTest' was built under R version 4.0.4
```

```
## 
## Attaching package: 'lmerTest'
```

```
## The following object is masked from 'package:lme4':
## 
##     lmer
```

```
## The following object is masked from 'package:stats':
## 
##     step
```

```r
ajuste_lmer &lt;- lmer(calificacion ~ tamanio + (1|montania), data = dragones)
tidy(ajuste_lmer) %&gt;% tibble::as_tibble()
```

```
## # A tibble: 4 x 8
##   effect   group    term            estimate std.error statistic    df p.value
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1 fixed    &lt;NA&gt;     (Intercept)      43.7      17.1        2.55   177.  0.0116
## 2 fixed    &lt;NA&gt;     tamanio           0.0332    0.0786     0.422  473.  0.673 
## 3 ran_pars montania sd__(Intercept)  18.4      NA         NA       NA  NA     
## 4 ran_pars Residual sd__Observation  15.0      NA         NA       NA  NA
```

Que es un random effect y como saber cuando es [random o fijo](https://dynamicecology.wordpress.com/2015/11/04/is-it-a-fixed-or-random-effect/)

---

## 2.10. Inspeccionar

Informacion de el ajuste: valores ajustados (.fitted), residuales (.resid)

```r
info_ajuste_lmer&lt;- augment_columns(ajuste_lmer,dragones)
```

Las montanias parecen tener un efecto en la calificacion.

```r
info_ajuste_lmer %&gt;% 
 ggplot(aes(x=tamanio,y=calificacion, colour=montania))+ 
 geom_jitter(alpha=2)+ 
 facet_wrap(~ montania)+
 geom_line(aes(x=tamanio,y=.fitted),
 colour="black")+
theme_bw()
```

![](Clase9-glm_files/figure-html/unnamed-chunk-26-1.png)&lt;!-- --&gt;

---

## 2.11. Supuestos


```r
plot(ajuste_lmer)
```

![](Clase9-glm_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;


```r
qqnorm(resid(ajuste_lmer))
qqline(resid(ajuste_lmer))
```

![](Clase9-glm_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;


```r
summary(ajuste_lmer)
```

```
## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: calificacion ~ tamanio + (1 | montania)
##    Data: dragones
## 
## REML criterion at convergence: 3991.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.4815 -0.6513  0.0066  0.6685  2.9583 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  montania (Intercept) 339.7    18.43   
##  Residual             223.8    14.96   
## Number of obs: 480, groups:  montania, 8
## 
## Fixed effects:
##              Estimate Std. Error        df t value Pr(&gt;|t|)  
## (Intercept)  43.70938   17.13489 177.46603   2.551   0.0116 *
## tamanio       0.03316    0.07865 472.66713   0.422   0.6734  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##         (Intr)
## tamanio -0.924
```

Aqui se ve claramente que la varianza de el sistema montanioso es 339.7.
Entonces las montanias son claramente importantes porque explican mucha de la variacion. Como saber cuanto explican de la variacion? Se puede tomar la varianza de la montania y dividirla por el total de la varianza. 


```r
339.7/(339.7 + 223.8)
```

```
## [1] 0.6028394
```


---
name: AIC

# 3. AIC

---

## 3.1. AIC

El AIC (Akaike Information criterion) es un modelo matermatico para evaluar que tan bien se ajusta el modelo a los datos generados. En estadistica se usa mucho para comparar dos modelos posibles y determinar cual es el mejor modelo.

AIC se calcula de:
- el numero de variables independientes que se uso para construir el modelo
- el estimado de maximum likelihood (que tan bien el modelo reproduce los datos)

El mejor modelo se identifica a partir de un AIC, que explica la mayor cantidad de variacion usando el menos numero de variables independientes. 


----

## 3.2. Dragones

Usando el ejemplo de dragones, que modelo se ajusta mejor a nuestros datos?
A lo mejor colectamos variables que no son importantes para nuestro modelo.

Los menos AIC son mejores, y AIC penaliza los modelos que usen mas parámetros.

---
name: nested_effects

## 3.1. Efectos aleatorios anidados

La variable de sitio es un factor con tres niveles: un sitio a, b y c. Y existe un anidamiento (nesting) del sitio con la montaña. Entonces los sitios no tienen significado si no le asignamos las montañas. Para no tener que estar recordando que esto ocurre, lo mejor es crear una nueva variable anidada (nested)


```r
dragones$muestra &lt;- factor(paste0(dragones$montania,dragones$sitio))
```

Recordando, el factor aleatorio solo aparece en un nivel en particular. Por eso es anidado, cada sitio pertenece a un sistema montañoso en especial y solo en ese sistema. Para efectos cruzados es cuando el factor aparece en mas de un nivel en otros factores, por ejemplo si el mismo dragón aparece en mas de un sistema montañoso. 

---

## 3.2. Factores aleatorios

De acuerdo a lo que vimos anteriormente, entonces no podemos poner los efectos aleatorios separados.

```r
modelo_incorrecto &lt;- lmer(calificacion ~ tamanio + 
                      (1|montania) + (1|sitio), data = dragones)  
```
Este modelo trata los efectos aleatorios como cruzados.


---

## 3.3. Modelo completo

Con los datos de dragones una manera de crear un modelo completo seria la siguiente.

```r
lmer_completo &lt;- lmer(calificacion ~ tamanio + (1|montania) + (1|muestra), 
				  data = dragones, REML = FALSE)
```


```r
lmer_completo
```

```
## Linear mixed model fit by maximum likelihood  ['lmerModLmerTest']
## Formula: calificacion ~ tamanio + (1 | montania) + (1 | muestra)
##    Data: dragones
##       AIC       BIC    logLik  deviance  df.resid 
##  3988.767  4009.636 -1989.383  3978.767       475 
## Random effects:
##  Groups   Name        Std.Dev.
##  muestra  (Intercept)  4.724  
##  montania (Intercept) 16.797  
##  Residual             14.434  
## Number of obs: 480, groups:  muestra, 24; montania, 8
## Fixed Effects:
## (Intercept)      tamanio  
##    39.09109      0.05611
```

---


## 3.4. Como se reporta eso?

De mejor a peor lo que podemos hacer es usar:

- Z-test de Wald 
- t-test de Wald (en este modelo los valores tendrian que estar balanceados)
- Prueba de razón de verosimilitud (en inglés: Likelihood ratio tests). Usando anova() o drop1())
- Markov chain Monte Carlo (MCMC) o un bootstramp parametrico con intervalos de confianza

---


## 3.5. Compara modelos

Modelo completo.

```r
lmer_completo &lt;- lmer(calificacion ~ tamanio + (1|montania) + (1|muestra), 
				  data = dragones, REML = FALSE)
```

Modelo reducido. **Nota** que no incluye tamaño.

```r
lmer_reducido &lt;- lmer(calificacion ~ 1 + (1|montania) + (1|muestra), 
					     data = dragones, REML = FALSE)
```

Comparación de los modelos.

```r
anova(lmer_reducido, lmer_completo)  # the two models are not significantly different
```

```
## Data: dragones
## Models:
## lmer_reducido: calificacion ~ 1 + (1 | montania) + (1 | muestra)
## lmer_completo: calificacion ~ tamanio + (1 | montania) + (1 | muestra)
##               npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)
## lmer_reducido    4 3987.1 4003.7 -1989.5   3979.1                     
## lmer_completo    5 3988.8 4009.6 -1989.4   3978.8 0.2868  1     0.5923
```

---

# 3.6. mas factores

Generar valores aleatorios

```r
set.seed(1234)
edad&lt;-runif(480, min=0, max=100)
set.seed(1234)
fuego&lt;-runif(480, min=0, max=15)
```

Agregar como variables

```r
dragones$edad&lt;-edad
dragones$fuego&lt;-fuego
```

---

# 3.7. drop1


```r
lmer_completo &lt;- lmer(calificacion ~ tamanio + edad + fuego +
                        (1|montania) + (1|muestra), 
				  data = dragones, REML = FALSE)
```

```
## fixed-effect model matrix is rank deficient so dropping 1 column / coefficient
```


```r
drop1(lmer_completo, test="F")
```

```
## Single term deletions using Satterthwaite's method:
## 
## Model:
## calificacion ~ tamanio + edad + fuego + (1 | montania) + (1 | muestra)
##         Sum Sq Mean Sq NumDF  DenDF F value Pr(&gt;F)
## tamanio 57.192  57.192     1 92.866  0.2745 0.6015
## edad                                              
## fuego
```


---

### 3.3. Comparar muchos modelos

Cargar paquetes

```r
library(lme4)
library(MuMIn)
```

Primer modelo

```r
mod1 &lt;- lmer(calificacion ~ tamanio + (1|montania) + (1|muestra), 
				  data = dragones, REML = FALSE)
```

Segundo modelo

```r
mod2 &lt;- lmer(calificacion ~ tamanio + fuego + (1|montania) + (1|muestra), 
					     data = dragones, REML = FALSE)
```

Tercer modelo

```r
mod3 &lt;- lmer(calificacion ~ tamanio + fuego + edad + (1|montania) + (1|muestra),data = dragones, REML = FALSE)
```

```
## fixed-effect model matrix is rank deficient so dropping 1 column / coefficient
```

---

### 3.4. Comparar muchos modelos


```r
library(MuMIn)
options(na.action = "na.fail")
```


```r
lmer_completo &lt;- lmer(calificacion ~ tamanio +
                        (1|montania) + (1|muestra), 
				  data = dragones, REML = FALSE)
```

AICs, delta y pesos (weight)

```r
dredge(lmer_completo)
```

```
## Fixed term is "(Intercept)"
```

```
## Global model call: lmer(formula = calificacion ~ tamanio + (1 | montania) + (1 | 
##     muestra), data = dragones, REML = FALSE)
## ---
## Model selection table 
##   (Intrc)   taman df    logLik   AICc delta weight
## 1   50.39          4 -1989.527 3987.1  0.00  0.706
## 2   39.09 0.05611  5 -1989.384 3988.9  1.76  0.294
## Models ranked by AICc(x) 
## Random terms (all models): 
## '1 | montania', '1 | muestra'
```


---

# 4. Para considerar

- [Usar Machine learning](https://github.com/m-clark/introduction-to-machine-learning)

- [Usar Estadistica bayesiana](https://oliviergimenez.github.io/blog/bayesworkshop/)

Otras lecturas:
- [El reinado de los valores p se ha terminado, ahora que hacemos?](https://royalsocietypublishing.org/doi/10.1098/rsbl.2019.0174)


---

class: left, inverse

# Contacto

Recapitulando

- [Reproducibilidad](#repro)
- [Publicaciones reproducibles](#pub)
- [Manuscritos reproducibles](#MS)

&lt;br&gt;
&lt;br&gt;

Para dudas, comentarios y sugerencias:  
- Escríbeme a miriamjlerma@gmail.com

&lt;br&gt;
&lt;br&gt;

.right[Este material esta accesible y se encuentra en &lt;br&gt;
mi [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#74c69d;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;github](https://github.com/MiriamLL/Curso_CIAD/)
y mi [&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#74c69d;" viewBox="0 0 576 512"&gt;&lt;path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/&gt;&lt;/svg&gt;página](https://miriamlerma.netlify.app/materiales.html)


.center[

&lt;h3&gt;&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#74c69d;" viewBox="0 0 576 512"&gt;&lt;path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/&gt;&lt;/svg&gt;[Volver ](https://miriamlerma.netlify.app/materiales.html)
]]

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
