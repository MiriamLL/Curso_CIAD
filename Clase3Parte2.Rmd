---
title: "Clase 3"
subtitle: "Data wrangling"
author: "Miriam Lerma"
date: "Febrero 2021"
output:
  xaringan::moon_reader:
    css: ["default","chocolate-fonts"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
---

# Intro

La clase es de 2 horas.

Teoria:  
- Funciones para unir y manipular data frames.

Practica: 
- Unir data frames.  
- Exportar tus datos.  


```{r, echo=FALSE}
library(emo)
```

---

# Ustedes

- Conocimientos básicos de R (saben abrirlo, cargar paquetes y datos).

- Quieren manipular sus data frames.

- Quieren exportar su nuevo data frame.


- Necesito:
Un voluntario que me ayude a hacer la pausa a la hora y me ayude a checar el chat si hay alguna pregunta que se me haya pasado
`r emo::ji("clock")`.

---

## Créditos

-Todo el material basado en el libro:  
[R4DS, editado por Riva Quiroga](https://r4ds-en-espaniol.netlify.app/)  

-Y materiales de RLadies   
[Zero to Hero](https://github.com/rladies/meetup-presentations_freiburg)  

-Presentaciones de tidyverse:  
[María Paula Caldas](https://mpaulacaldas.github.io/rrrtidyverse/)`r emo::ji("star")`  
[RLadiesBuenosAires](https://www.youtube.com/watch?v=ycudMihLues&t=3605s)


-Imágenes adicionales
[Unsplash](https://unsplash.com/)

---

class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1527402858-36f052d83df4?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1267&q=80)
background-size: cover

# Unir y exportar

---

## Datos pinguinos. 
`r emo::ji("penguin")`

Cargen sus datos, que los vamos a usar mas adelante.
```{r}
library(datos)
Pingus<-datos::pinguinos
```
Otra opcion es usar read_csv desde su computador.

```{r}
library(tidyverse)
```

---

# 6.1. left_join()

Datos inventados.
```{r}
ID<-c("ID01","ID02","ID03","ID04","ID05",
      "ID06","ID07","ID08","ID09","ID10")
Pesos<-c(1.5,2.0,3.5,4.1,2.6,3.7,8.9,2.5,6.3,1.0)
Pesticidas<-c(10,20,35,1,6,3,8,2,3,1)
```

---

# 6.1. left_join()

Muchas veces tengo datos de laboratorio por un lado...
```{r}
Laboratorio<-data.frame(ID,Pesticidas)
head(Laboratorio)
```

--
... y de campo por otro.
```{r}
Libreta <- data.frame(ID,Pesos)
head(Libreta)
```

---

# 6.1. left_join()

- left_join() me permite unirlos.
```{r}
DatosJuntos<-left_join(Libreta, Laboratorio, 
                       by = "ID") #<<
DatosJuntos
```

---

# 6.2. pivot_longer
A veces los datos se toman de manera *"no ordenada"* en el sentido de que las observaciones estan en cada columna y no en cada fila.

Esto es normal, particularmente en campo o en el laboratorio y tenemos una libreta con espacio limitado.

Entonces hay que re-organizarlos.

```{r echo=FALSE, out.height=200}
knitr::include_graphics('https://r4ds-en-espaniol.netlify.app/diagrams_w_text_as_path/es/tidy-9.svg')
```

---

# 6.2. pivot_longer

Datos inventados de 5 especies y sus riquezas.
```{r}
Especies<-c('Especie1','Especie2','Especie3','Especie4','Especie5')
Anio2010<-c(5,4,5,6,7)
Anio2011<-c(3,2,1,9,4)
Anio2012<-c(6,2,3,7,8)
```

Un nuevo data frame.
```{r}
EspecieAnio<-data.frame(Especie=Especies,
                        Anio2010=Anio2010,Anio2011=Anio2011,Anio2012)
```

```{r}
head(EspecieAnio)
```

---

# 6.2. pivot_longer

Este argumento me permite reorganizarlas.
```{r}
Especies_largo <- EspecieAnio %>%
  pivot_longer(c(Anio2010, Anio2011, Anio2012),
    names_to = "Anio",
    values_to = "Riqueza" )
Especies_largo
```

---

# 6.3. pivot_wider

Pero si por alguna razon quiero tenerlos separados, puedo tambien extraerlos a lo ancho.

```{r echo=FALSE, out.height=450}
knitr::include_graphics('https://r4ds-en-espaniol.netlify.app/diagrams_w_text_as_path/es/tidy-8.svg')
```

---

# 6.3. pivot_wider

Datos inventados.
```{r}
Especies_ancho<-Especies_largo %>% 
  pivot_wider(names_from = Anio, 
              values_from = Riqueza)
Especies_ancho
```

---

# 6.4. Unite

Para unir informacion de dos columnas en una columna.
```{r}
(Pingus<-Pingus %>% 
  unite(col = especie_isla,
        c("especie", "isla"),
        sep = ": "))
```

---

# 6.5. Separate

Separar valores de una columna en dos columnas.
```{r, eval=FALSE}
Pingus %>% 
  separate(col = especie_isla,
           into = c("especie", "isla"),
           sep = ":")
```
Ojo: borra las columnas originales, si no queremos que las borre debemos agregar remove = FALSE.

```{r}
(Pingus<-Pingus %>% 
  separate(col = especie_isla,
           into = c("especie", "isla"),
           sep = ":",
           remove = FALSE))
```


---

# 6.6. Rename
Cambiar el nombre de la columna.  
El nuevo nombre se pone primero y luego se pone el nombre anterior.
```{r}
Pingus %>% 
  rename(peso = masa_corporal_g)
```

---
# 6.6. Rename
Cambiar el nombre de varias columnas.  
El nuevo nombre se pone primero y luego se pone el nombre anterior.

```{r}
Pingus %>% 
  rename(peso=masa_corporal_g, 
         temporada=anio)
```

---

# 6.7. Relocate

Mover columnas al inicio del data frame.
```{r}
Pingus %>% 
  relocate(sexo, anio)
```

---

# 6.8 ggplot()

Podemos encadenar funciones y crear graficos.

```{r}
Pingus %>%
  filter(sexo=='hembra') %>%
  ggplot(aes(x = largo_pico_mm)) +
  geom_histogram()
```

---


class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1559311648-addd6af95dd4?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80)
background-size: cover

# Su turno!

---

## 6.9 Ejercicios
### Paquetes

```{r}
library(tidyverse)
library(datos)
```

```{r}
Pingus<-datos::pinguinos
```

---

## 6.9. Ejercicios
### pivot_wider()

```{r, warning=FALSE}
PingusAncho<-Pingus %>% 
  pivot_wider(names_from = especie, 
              values_from = largo_pico_mm)
PingusAncho
```

---

## 6.9. Ejercicios
### pivot_longer()

```{r}
PingusLargo <- PingusAncho %>%
  pivot_longer(c(Adelia, Papúa, Barbijo),
    names_to = "Especies",
    values_to = "largo_pico_mm" )
```

---

## 6.9. Ejercicios
### unite()

```{r}
PingusEspecieSexo<-Pingus %>% 
  unite(col = especie_sexo,
        c("especie", "sexo"),
        sep = ": ")
```

---

## 6.9. Ejercicios
### separate()

```{r}
PingusSeparate<-PingusEspecieSexo %>% 
 separate(col = especie_sexo,
           into = c("especie", "sexo"),
           sep = ":")
```

---

## 6.9. Ejercicios
### relocate()

```{r}
PingusRelocate<-Pingus %>% 
  relocate(sexo, anio)
```

---

## 6.9. Ejercicios
### left_join()

Datos inventados.
```{r}
ID<-c("ID01","ID02","ID03","ID04","ID05",
      "ID06","ID07","ID08","ID09","ID10")
Pesos<-c(1.5,2.0,3.5,4.1,2.6,3.7,8.9,2.5,6.3,1.0)
Pesticidas<-c(10,20,35,1,6,3,8,2,3,1)
```

Datos del laboratorio.
```{r}
Laboratorio<-data.frame(ID,Pesticidas)
```

Datos de campo.
```{r}
Libreta <- data.frame(ID,Pesos)
```

DatosJuntos.
```{r}
DatosJuntos<-left_join(Libreta, Laboratorio, 
                       by = "ID") #<<
```

---

## 6.9. Ejercicios
### ggplot()
  
Datos inventados de 5 especies y sus riquezas.
```{r}
Especies<-c('Especie1','Especie2','Especie3','Especie4','Especie5')
Anio2010<-c(5,4,5,6,7)
Anio2011<-c(3,2,1,9,4)
Anio2012<-c(6,2,3,7,8)
```

Un nuevo data frame.
```{r}
EspecieAnio<-data.frame(Especie=Especies,
                        Anio2010=Anio2010,Anio2011=Anio2011,Anio2012)
```

```{r}
head(EspecieAnio)
```

---

# 6.9. pivot_longer

Este argumento me permite reorganizarlas.
```{r}
EspeciesLargo <- EspecieAnio %>%
  pivot_longer(c(Anio2010, Anio2011, Anio2012),
    names_to = "Anio",
    values_to = "Riqueza" )
EspeciesLargo
```

---

# 6.9. pivot_longer
Importante el acomodo para poder realizar el grafico.

```{r}
ggplot(EspeciesLargo, aes(x=Especie,y=Riqueza, color=Anio, fill=Anio))+
         geom_bar(stat='identity')
```


---

# 7. Exportar tu data.frame

Igual que los argumentos para importar tus datos (read_csv), cada uno tiene su contra parte para exportarlos.
- write_csv()  
- write_csv2()  
- write_tsv()  
- write_delim()  

---

# 7. Exportar tu data.frame
## Ahora tu

1- Define la carpeta.  
```{r}
library(here)
ResultsFolder<-here::here("Clase3 wrangling")
```

2-  Exporta tu tabla.
```{r, eval=FALSE}
write_csv(
  DatosJuntos,
  file =paste0(ResultsFolder,'/DatosJuntos.csv'))
```


---

# 8. Continuar aprendiendo

[CheatSheet](https://dplyr.tidyverse.org/)

[EjerciciosInteractivos](https://allisonhorst.shinyapps.io/edge-of-the-tidyverse/#section-wrangling-in-dplyr)


---

class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1533630160910-65f5a1718c65?ixlib=rb-1.2.1&ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&auto=format&fit=crop&w=1350&q=80)
background-size: cover


# Recapitulando

1.1. Unir data frames.  
1.2. Renombrar columnas.  
1.2. Exportar data frames.  

---
